---
title: "Github Discussion ì£¼ê°„ í†µê³„ ìë™í™” ì‹œìŠ¤í…œ êµ¬ì¶•í•˜ê¸° - 1"
date: "2023-08-23T20:38:03.284Z"
description: "JavaScriptì™€ Github GraphQLì„ í™œìš©í•´ ìë™í™” ì‹œìŠ¤í…œì„ êµ¬ì¶•í•´ë³´ì."
section: "ë¬¸ì œ í•´ê²°" 
category: "ì£¼ì €ë¦¬ì£¼ì €ë¦¬"
tags:
  - javascript
  - ìë™í™”
thumbnailImg: "./8.png"
---

## 0. ì„œë¡ 

---

ë‚´ê°€ ìš°ì•„í•œ í…Œí¬ì½”ìŠ¤ì—ì„œ ì°¸ì—¬í•˜ê³  ìˆëŠ” ê¾¸ê¸€ì“°(ê¾¸ì¤€íˆ ê¸€ì“°ê¸° ëª¨ì„)ì—ì„œëŠ” í¬ë£¨ë“¤ì´ ë””ìŠ¤ì»¤ì…˜ì„ ì˜¬ë¦´ ë•Œë§ˆë‹¤ ì•ŒëŒì´ ì˜¤ê³ , ë§¤ì£¼ ê¸€ì„ ì‘ì„±í•˜ì§€ ì•Šì€ í¬ë£¨ë“¤ì„ ì°¾ì•„ ì•Œë ¤ì£¼ëŠ” ë“± í¸ë¦¬í•œ ê¸°ëŠ¥ì´ ëª‡ê°€ì§€ ë§ˆë ¨ë˜ì–´ ìˆë‹¤. ë•ë¶„ì— ê¸€ ì“°ê¸°ë¥¼ ìŠì–´ë²„ë¦¬ì§€ ì•Šê³  ê¾¸ì¤€íˆ ì°¸ì—¬í•  ìˆ˜ ìˆì—ˆë‹¤.

ê·¸ëŸ¬ë‹¤ê°€ ì´ë²ˆì— ì¹œêµ¬ë“¤ê³¼ ë¹„ìŠ·í•œ ê±¸ í•˜ê²Œ ë˜ì–´ì„œ, ì—ì½”ì—ê²Œ ë°©ë²•ì„ ì „ìˆ˜ë°›ì•„ ê·¸ ê¸°ëŠ¥ë“¤ì„ ì§ì ‘ êµ¬í˜„í•´ë³´ê³ , ê·¸ ê³¼ì •ì„ ë¬¸ì„œí™”í•´ë³´ì•˜ë‹¤.

ë„ì›€ì„ ì¤€ ì—ì½”ì—ê²Œ ê°ì‚¬ ì¸ì‚¬ë¥¼ ë‚¨ê¸´ë‹¤.

## 1. ìƒˆ ê¸€ ì•Œë¦¼ ë°›ê¸°

---

### ì‚¬ì „ ì‘ì—…

1. Slack ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì— Github ì•±ì„ ì„¤ì¹˜í•œë‹¤.
2. Github ê³„ì •ì— Slack ì•±ì„ ì„¤ì¹˜í•œë‹¤.

### ê³¼ì •

ì•ŒëŒì„ ìˆ˜ì‹ í•˜ê³ ì í•˜ëŠ” ì±„ë„ì— ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•œë‹¤.

```
/github subscribe ê³„ì •ëª…/ë ˆí¬ëª… discussions
```

![Untitled](1.png)

ì´ê±¸ ê·¸ëŒ€ë¡œ ì…ë ¥í•´ì£¼ë©´ ëœë‹¤.

![Untitled](2.png)

ì´ë ‡ê²Œ ë˜ë©´ ì„±ê³µ.

<aside>
ğŸ’¡ ë§Œì•½, ë””ìŠ¤ì»¤ì…˜ì˜ íŠ¹ì • ì¹´í…Œê³ ë¦¬ì— ëŒ€í•´ì„œë§Œ ì•ŒëŒì„ ë°›ê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•˜ë©´ ëœë‹¤.

```
/github subscribe ê³„ì •ëª…/ë ˆí¬ëª… discussions:{category:"ì¹´í…Œê³ ë¦¬1", "ì¹´í…Œê³ ë¦¬ëª…2"}
```

</aside>

ì´ì œ discussionì— ìƒˆ ê¸€ì´ ì˜¬ë¼ì˜¬ ë•Œë§ˆë‹¤ ì‚¬ì§„ì²˜ëŸ¼ ì±„ë„ì— ë””ìŠ¤ì»¤ì…˜ ì •ë³´ê°€ ì˜¬ë¼ì˜¤ê²Œ ëœë‹¤.

![Untitled](3.png)

## 2. ì£¼ê°„ í†µê³„ë¥¼ ë””ìŠ¤ì»¤ì…˜ì— ì—…ë¡œë“œí•˜ê¸°

---

ì—ì½”ì˜ ê²½ìš° íŒŒì´ì¬ìœ¼ë¡œ êµ¬í˜„í–ˆëŠ”ë°, ë‚˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ë” ìµìˆ™í•œë°ë‹¤ ê´œíˆ ë„ì „ ì •ì‹ ì´ ìƒê²¨ì„œ ìƒ‰ë‹¤ë¥´ê²Œ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ êµ¬í˜„í•´ë³´ì•˜ë‹¤.

ë¨¼ì € Githubì—ì„œ ì œê³µí•´ì£¼ëŠ” GraphQL APIë¥¼ í˜¸ì¶œí•´ì„œ Github ë””ìŠ¤ì»¤ì…˜ì— ê¸€ì„ ê²Œì‹œí•  ìˆ˜ ìˆëŠ”ë°, GraphQLì— ëŒ€í•´ ì˜ ëª¨ë¥´ëŠ” ê´€ê³„ë¡œ ì •í™•íˆ ë­í•˜ëŠ” ë…€ì„ì¸ì§€ ì•Œì•„ë³´ì•˜ë‹¤.

[Using the GraphQL API for Discussions - GitHub Docs](https://docs.github.com/en/graphql/guides/using-the-graphql-api-for-discussions)

### GraphQL

: í˜ì´ìŠ¤ë¶(Meta)ì—ì„œ ë§Œë“  ì¿¼ë¦¬ ì–¸ì–´.

SQLê³¼ì˜ ì°¨ì´ëŠ”, SQLì€ **ë°ì´í„°ë² ì´ìŠ¤** ì‹œìŠ¤í…œì— ì €ì¥ëœ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ëª©ì ìœ¼ë¡œ ì„¤ê³„ëœ ë°˜ë©´, GraphQLì€ **ì›¹ í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ë¡œë¶€í„°** ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ëª©ì ìœ¼ë¡œ ì„¤ê³„ë˜ì—ˆë‹¤ëŠ” ê²ƒì´ë‹¤.

í™œìš© ì¸¡ë©´ì—ì„œëŠ” SQLì€ ì£¼ë¡œ **ë°±ì—”ë“œ ì‹œìŠ¤í…œ**ì—ì„œ ì‘ì„±ë˜ê³  í˜¸ì¶œë˜ëŠ” ë°˜ë©´ GraphQLì€ **í´ë¼ì´ì–¸íŠ¸ ì‹œìŠ¤í…œ**ì—ì„œ ì‘ì„±í•˜ê³  í˜¸ì¶œí•œë‹¤.

```sql
SELECT plot_id, species_id, sex, weight, ROUND(weight / 1000.0, 2) FROM surveys;
```

```graphql
{
  hero {
    name
    friends {
      name
    }
  }
}
```

í´ë¼ì´ì–¸íŠ¸ì—ì„œ GraphQL ë¬¸ì¥ì„ ì‚¬ìš©í•´ ì„œë²„ë¡œë¶€í„° ë°ì´í„°ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì—ì„œ, GraphQLì€ APIë¼ê³  ë³¼ ìˆ˜ë„ ìˆëŠ”ë° ê·¸ëŸ¼ REST APIì™€ì˜ ì°¨ì´ëŠ” ë­˜ê¹Œ?

- **REST APIì™€ GraphQLì˜ ì°¨ì´**

  REST APIëŠ” URL, METHODë¥¼ ì¡°í•©í•œ ë‹¤ì–‘í•œ Endpointê°€ ì¡´ì¬í•  ìˆ˜ ìˆì§€ë§Œ, GraphQLì€ ë‹¨ í•˜ë‚˜ì˜ Endpointë§Œ ì¡´ì¬í•œë‹¤.

  ê·¸ë¦¬ê³  GraphQL APIì—ì„œëŠ” ë¶ˆëŸ¬ì˜¤ëŠ” ë°ì´í„°ì˜ ì¢…ë¥˜ë¥¼ ì¿¼ë¦¬ ì¡°í•©ì„ í†µí•´ì„œ ê²°ì •í•œë‹¤.

  REST APIì—ì„œëŠ” ê° Endpointë§ˆë‹¤ ë°ì´í„°ë² ì´ìŠ¤ SQL ì¿¼ë¦¬ê°€ ë‹¬ë¼ì§€ì§€ë§Œ, GraphQL APIëŠ” GraphQL ìŠ¤í‚¤ë§ˆì— ë”°ë¼ ë°ì´í„°ë² ì´ìŠ¤ SQL ì¿¼ë¦¬ê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆë‹¤.
  ![graphql-mobile-api.png](4.png)

- ê·¸ ì™¸ íŠ¹ì§•
  - GraphQLì˜ ìš”ì²­ ì¿¼ë¦¬ë¬¸ê³¼ ì‘ë‹µ ë°ì´í„°ì˜ í˜•ì‹ì€ ê±°ì˜ ì¼ì¹˜í•œë‹¤.
  - GraphQLì€ ê°„ë‹¨íˆ ìŠ¤í‚¤ë§ˆ+ë¦¬ì¡¸ë²„ë¡œ êµ¬ì„±ëœë‹¤. ìŠ¤í‚¤ë§ˆ ì•ˆì— ë³€ìˆ˜ë‚˜ í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ê³ , ë¦¬ì¡¸ë²„ì—ì„œ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•˜ë©´ ëœë‹¤.
- ìŠ¤í‚¤ë§ˆ/íƒ€ì…
  ```graphql
  type Character {
    name: String!
    appearsIn: [Episode!]!
  }
  ```
  - ì˜¤ë¸Œì íŠ¸ íƒ€ì… : Character
  - í•„ë“œ : name, appearsIn
  - ìŠ¤ì¹¼ë¼ íƒ€ì… : String, ID, Int ë“±
  - ëŠë‚Œí‘œ(!) : í•„ìˆ˜ ê°’ì„ ì˜ë¯¸(non-nullable)
  - ëŒ€ê´„í˜¸([, ]) : ë°°ì—´ì„ ì˜ë¯¸(array)
- ë¦¬ì¡¸ë²„(resolver)
  - GraphQLì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” êµ¬ì²´ì ì¸ ê³¼ì •ì€ ë¦¬ì¡¸ë²„ê°€ ë‹´ë‹¹í•˜ëŠ”ë°, ì´ë¥¼ í”„ë¡œê·¸ë˜ë¨¸ê°€ ì§ì ‘ êµ¬í˜„í•´ì£¼ì–´ì•¼ í•œë‹¤.
  - gql ì¿¼ë¦¬ì—ì„œëŠ” ê°ê°ì˜ í•„ë“œë§ˆë‹¤ í•¨ìˆ˜ê°€ í•˜ë‚˜ì”© ì¡´ì¬ í•œë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤. ì´ í•¨ìˆ˜ëŠ” í•´ë‹¹ í•„ë“œì˜ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ë©°, ì´ëŸ¬í•œ ê°ê°ì˜ í•¨ìˆ˜ë¥¼ ë¦¬ì¡¸ë²„(resolver)ë¼ê³  í•œë‹¤.
    ë¦¬ì¡¸ë²„ëŠ” ì—°ì‡„ì ìœ¼ë¡œ í˜¸ì¶œëœë‹¤.

ì´ë ‡ê²Œ ëŒ€ëµì ìœ¼ë¡œ GraphQLì˜ ê°œë…ì— ëŒ€í•´ ì•Œì•„ë´¤ë‹¤.

ê·¸ëŸ¼ ì´ì œ JavaScriptì—ì„œ GraphQLì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì.

### JavaScriptì—ì„œ GraphQL ì‚¬ìš©í•˜ê¸°

ë¨¼ì € Repositoryì— ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆëŠ” ê¶Œí•œì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì—, **Github Personal Tockenì„ ë°œê¸‰**ë°›ëŠ”ë‹¤.

[í† í° ë°œê¸‰ ë§í¬](https://github.com/settings/tokens/)

ê·¸ í›„ graphqlì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ **íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜**í•´ì¤€ë‹¤.

```bash
npm install @octokit/graphql
```

GraphQLì˜ ì‚¬ìš©ë²•ì„ ìµíˆê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì‘ì„±í•´ì£¼ì—ˆë‹¤.

- test/test_graphql.js

```bash
const { graphql } = require('@octokit/graphql')

async function repo() {
  const mytoken = [Github Personal í† í°]
  const { repository, viewer } = await graphql(    `
      {
        repository(owner: "amaran-th", name: "every-week-posting-challenge") {
          discussions(first: 10) {
            totalCount
						edges {
              node {
                id
                title
                createdAt
                url
                author {
                  login
                  avatarUrl
                }
              }
            }
          }
        }
        viewer {
          login
        }
      }
    `,
    {
      headers: {
        authorization: `token ${mytoken}`,
      },
    }
  )
  console.log(
    repository.discussions.totalCount,
    repository.discussions.edges,
    viewer
  )
}

repo()
```

ê·¸ë¦¬ê³  í„°ë¯¸ë„ì— ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì„œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤.

```bash
node test/test_graphql.js
```

ê·¸ëŸ¼ ì§€ì •í•œ Github Repository(amaran-th/every-week-posting-challenge)ë¡œë¶€í„° ìƒìœ„ 10ê°œì˜ Discussion ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë‹¤.

Github ê³µì‹ ë¬¸ì„œì— ë‚˜ì™€ìˆëŠ” Discussion ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•œ ê¸°ë³¸ì ì¸ GraphQL ì¿¼ë¦¬ ì–‘ì‹ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

```graphql
query {
  repository(owner: "github", name: "some-repo") {
    discussions(first: 10) {
      # type: DiscussionConnection
      totalCount # Int!
      pageInfo {
        # type: PageInfo (from the public schema)
        startCursor
        endCursor
        hasNextPage
        hasPreviousPage
      }

      edges {
        # type: DiscussionEdge
        cursor
        node {
          # type: Discussion
          id
        }
      }

      nodes {
        # type: Discussion
        id
      }
    }
  }
}
```

Githubì—ì„œ ì œê³µí•˜ëŠ” GraphQL APIì—ì„œ, Discussion typeì— ëŒ€í•œ ìŠ¤í‚¤ë§ˆëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

[Using the GraphQL API for Discussions - GitHub Docs](https://docs.github.com/en/graphql/guides/using-the-graphql-api-for-discussions)

```graphql
type Discussion implements Comment & Deletable & Lockable & Node & Reactable & RepositoryNode & Subscribable & Updatable {
  activeLockReason: LockReason
  answer: DiscussionComment
  answerChosenAt: DateTime
  answerChosenBy: Actor
  author: Actor
  authorAssociation: CommentAuthorAssociation!
  body: String!
  bodyHTML: HTML!
  bodyText: String!
  section: "ì§€ì‹ ê³µìœ " 
category: DiscussionCategory!
  comments(
    after: String
    before: String
    first: Int
    last: Int
  ): DiscussionCommentConnection!
  createdAt: DateTime!
  createdViaEmail: Boolean!
  databaseId: Int
  editor: Actor
  id: ID!
  includesCreatedEdit: Boolean!
  lastEditedAt: DateTime
  locked: Boolean!
  number: Int!
  publishedAt: DateTime
  reactionGroups: [ReactionGroup!]
  reactions(
    after: String
    before: String
    content: ReactionContent
    first: Int
    last: Int
    orderBy: ReactionOrder
  ): ReactionConnection!
  repository: Repository!
  resourcePath: URI!
  title: String!
  updatedAt: DateTime!
  url: URI!
  userContentEdits(
    after: String
    before: String
    first: Int
    last: Int
  ): UserContentEditConnection
  viewerCanDelete: Boolean!
  viewerCanReact: Boolean!
  viewerCanSubscribe: Boolean!
  viewerCanUpdate: Boolean!
  viewerDidAuthor: Boolean!
  viewerSubscription: SubscriptionState
}
```

<aside>
ğŸ’¡ ì—¬ê¸°ì„œ ì‚¬ìš©ëœ edgesì™€ nodeì— ëŒ€í•´ì„œ ì°¾ì•„ë³´ë‹ˆ, ì–´ë–¤ ë°ì´í„°ì˜ ë¦¬ìŠ¤íŠ¸ê°€ ìˆì„ ë•Œ, ê° ë°ì´í„°ë¥¼ node, ë‘ nodeë¥¼ ì—°ê²°í•˜ëŠ” ê´€ê³„ë¥¼ edgeë¼ê³  í•œë‹¤ê³  í•œë‹¤.

ì¼ë‹¨ì€ ë°ì´í„°ì˜ ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•œ í¬ë§·ìœ¼ë¡œ ì´í•´í–ˆë‹¤.

</aside>

ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ í™•ì¸í–ˆìœ¼ë‹ˆ, ì´ì œ ì£¼ê°„ í†µê³„ ê²Œì‹œë¬¼ì˜ ì–‘ì‹ì„ êµ¬ì„±í•´ë³´ì.

### Title êµ¬ì„±

`í‚¤ê¸€ì±Œ OOíšŒì°¨ í†µê³„(OOì›” OOì¼ ~ OOì›” OOì¼)` ì´ë¼ëŠ” í˜•ì‹ìœ¼ë¡œ í†µê³„ ë””ìŠ¤ì»¤ì…˜ì˜ Titleì„ êµ¬ì„±í•˜ë ¤ í•œë‹¤.

ì œì¼ ë¨¼ì € graphql.js íŒŒì¼ì— ë””ìŠ¤ì»¤ì…˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜ë¥¼ ì‘ì„±í•´ì£¼ì—ˆë‹¤.

- `every_week_posting_challenge/graphql.js`

  ```jsx
  const { graphql } = require('@octokit/graphql')

  exports.getDiscussions = async function getDiscussions() {
    const mytoken = { Github í† í° ê°’ }
    return await graphql(
      `
        {
          repository(owner: "amaran-th", name: "every-week-posting-challenge") {
            discussions(first: 100) {
              totalCount
              edges {
                node {
                  id
                  title
                  createdAt
                  url
                  author {
                    login
                    avatarUrl
                  }
                  category {
                    name
                  }
                }
              }
            }
          }
          viewer {
            login
          }
        }
      `,
      {
        headers: {
          authorization: `token ${mytoken}`,
        },
      }
    )
  }
  ```

Github Tokenê³¼ ê°™ì´ ë¯¼ê°í•œ ì •ë³´ë¥¼ .env íŒŒì¼ì— ìˆ¨ê²¨ì£¼ê¸° ìœ„í•´ dotenv ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•´ì¤€ë‹¤.

```bash
npm install --save-dev dotenv
```

- `.env`
  ```bash
  GITHUB_TOKEN='ê¹ƒí—ˆë¸Œ í† í° ê°’'
  ```
- `every_week_posting_challenge/graphql.js`

  ```jsx
  ...
  require('dotenv/config')

  exports.getDiscussions = async function getDiscussions() {
    const mytoken = process.env.GITHUB_TOKEN
  	...
  }
  ```

ê·¸ ë‹¤ìŒ, í˜„ì¬ ë‚ ì§œì™€ ì¼ì£¼ì¼ ì „ì˜ ë‚ ì§œë¥¼ ì„ ì–¸í•œë‹¤. í˜¹ì‹œëª¨ë¥¼ TimeZone ì´ìŠˆë¥¼ ëŒ€ë¹„í•´ moment-timezone ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í–ˆë‹¤.

- `every_week_posting_challenge/notify.js`

  ```jsx
  const { getDiscussions } = require("./graphql")
  const moment = require("moment")
  require("moment-timezone")

  moment.tz.setDefault("Asia/Seoul")

  async function repo() {
    const { repository, viewer } = await getDiscussions()
    const now = moment()
    const last_week = now.clone().subtract(7, "d")
  }

  repo()
  ```

ì˜¤ëŠ˜ì´ ëª‡ ë²ˆì§¸ íšŒì°¨ì¸ì§€ë¥¼ ì•Œê¸° ìœ„í•´ ì£¼ê°„ í†µê³„ ì¹´í…Œê³ ë¦¬ì˜ ë””ìŠ¤ì»¤ì…˜ ê°œìˆ˜(notificationCount)ë¥¼ êµ¬í•œë‹¤.

- `every_week_posting_challenge/graphql.js`

```jsx
exports.getNotifyDiscussions = async function getNotifyDiscussions() {
  const mytoken = process.env.GITHUB_TOKEN
  return await graphql(
    `
      {
        repository(owner: "amaran-th", name: "every-week-posting-challenge") {
          discussions(first: 100, categoryId: "DIC_kwDOJjgAhs4CWp1V") {
            totalCount
          }
        }
        viewer {
          login
        }
      }
    `,
    {
      headers: {
        authorization: `token ${mytoken}`,
      },
    }
  )
}
```

```jsx
	const { repository } = await getNotifyDiscussions()
  const notificationCount = repository.discussions.totalCount
}

```

ì§€ê¸ˆê¹Œì§€ ì–»ì€ ì •ë³´ë¡œ notify ë””ìŠ¤ì»¤ì…˜ì˜ ì œëª©(title)ì„ êµ¬ì„±í•œë‹¤.

```jsx
	const { repository, viewer } = await getDiscussions()
  const now = moment()
  const last_week = now.clone().subtract(7, 'd')

  const resultTitle = makeTitle(repository, last_week, now)
...
}

function makeTitle(repository, last_week, now) {
  const notificationCount = repository.discussions.edges.filter(edge => {
    return edge.node.category.name === 'ì£¼ê°„ í†µê³„'
  }).length
  const yesterday = now.clone().subtract(1, 'd')

  return `í‚¤ê¸€ì±Œ ${notificationCount + 1}íšŒì°¨ í†µê³„(
    ${last_week.format('MMì›” DDì¼')} ~
    ${yesterday.format('MMì›” DDì¼')})`
}
```

![Untitled](5.png)

### ë””ìŠ¤ì»¤ì…˜ Content êµ¬ì„±

ê¸°ì¡´ì— ê²Œì‹œí–ˆë˜ ì£¼ê°„ í†µê³„ ë””ìŠ¤ì»¤ì…˜ ë‚´ìš©ì˜ ì–‘ì‹ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

![Untitled](6.png)

í•œ ì£¼ê°„ ì‘ì„±ëœ ê²Œì‹œê¸€ì˜ ê°œìˆ˜, ë©¤ë²„ ë³„ ì‘ì„±ëœ ê²Œì‹œê¸€ ê°œìˆ˜, ì±Œë¦°ì§€ë¥¼ ìˆ˜í–‰í•˜ì§€ ì•Šì€ ë©¤ë²„ ìˆ˜ì™€ ì´ë¦„ë“¤, ë°˜ì„±ë¬¸ ë§ˆê° ì¼ì ì´ë ‡ê²Œ í¬ê²Œ 4ê°€ì§€ ì •ë³´ë¥¼ í•„ìš”ë¡œ í•œë‹¤.

1. í•œ ì£¼ê°„ ì‘ì„±ëœ ê²Œì‹œê¸€ì˜ ê°œìˆ˜(thisWeekDiscussionCount)

   - `every_week_posting_challenge/notify.js`

     ```jsx
     const moment = require("moment")
     require("moment-timezone")
     const { getDiscussions } = require("./graphql")

     moment.tz.setDefault("Asia/Seoul")

     async function repo() {
       const { repository, viewer } = await getDiscussions()
       const now = moment()
       const last_week = now.clone().subtract(7, "d")

       const filteredDiscussions = filterThisWeekDiscussion(
         repository,
         last_week
       )
       const thisWeekDiscussionCount = filteredDiscussions.length
     }

     function filterThisWeekDiscussion(repository, last_week) {
       return repository.discussions.edges.filter(edge => {
         return (
           moment(edge.node.createdAt) > last_week &&
           edge.node.category.name !== "6. ë°˜ì„±ë¬¸" &&
           edge.node.category.name !== "ì£¼ê°„ í†µê³„"
         )
       })
     }

     repo()
     ```

     ë°˜ì„±ë¬¸ì„ ì œì™¸í•˜ê³  ì¹´ìš´íŠ¸í•´ì•¼ í•˜ë¯€ë¡œ, ì¹´í…Œê³ ë¦¬ì™€ ë””ìŠ¤ì»¤ì…˜ ìƒì„± ì¼ìë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë§í•œë‹¤.

2. ë©¤ë²„ ë³„ ì‘ì„±ëœ ê²Œì‹œê¸€ ê°œìˆ˜(result)

   - `every_week_posting_challenge/data.js`

     membersëŠ” ëª¨ë“  ì°¸ì—¬ìë“¤ì˜ í‚¤ë¡œ Github usernameì„, ê°’ìœ¼ë¡œ í•œê¸€ ì‹¤ëª…ì„ ê°€ì§€ê³  ìˆëŠ” ê°ì²´ì´ê³ , activeMembersëŠ” íœ´ë©´ ë©¤ë²„ë¥¼ ì œì™¸í•œ ì‹¤ì œ í™œë™ ë©¤ë²„ë“¤ì˜ Github username ë¦¬ìŠ¤íŠ¸ì´ë‹¤.

     ```jsx
     exports.members = {
     		'example1': 'ê¹€ê¸¸ë™',
     		'example2': 'ë°•ê¸¸ë™',
     		'example3': 'ì´ê¸¸ë™',
     		'example4': 'ì¥ê¸¸ë™',
     		'example5': 'ìµœê¸¸ë™',
     		'example6': 'ì†¡ê¸¸ë™',
     		'example7': 'ë°±ê¸¸ë™',
     ]

     exports.activeMembers = [
       'example1',
       'example2',
       'example3',
       'example4',
       'example5',
     ]
     ```

   - `every_week_posting_challenge/notify.js`

     ```jsx
     	...
     	const filteredDiscussions = filterThisWeekDiscussion(repository, last_week)
     	let result = makeResult(filteredDiscussions)
     	...
     }

     function makeResult(filteredDiscussions) {
       let result = {}
       Object.keys(members)
         .filter(member =>
           activeMembers.find(activeMember => activeMember === member)
         )
         .map(member => {
           result[members[member]] = 0
         })
       filteredDiscussions.map(edge => {
         result[members[edge.node.author.login]]++
       })
       return result
     }
     ```

     ![Untitled](7.png)

3. ì±Œë¦°ì§€ë¥¼ ìˆ˜í–‰í•˜ì§€ ì•Šì€ ë©¤ë²„ ì •ë³´(notPostingMembers)

   - `every_week_posting_challenge/notify.js`

     ```jsx
     	...
     	let result = makeResult(filteredDiscussions)
       let notPostingMembers = makeNotPostingMembers(result)
       let notPostMembersText = notPostingMembers.join(', ')
     	let notPostMembersCount = notPostingMembers.length
     }

     function makeNotPostingMembers(result) {
       let notPostingMembers = []
       activeMembers.map(activeMember => {
         if (result[members[activeMember]] === 0)
           notPostingMembers.push(members[activeMember])
       })
       return notPostingMembers
     }
     ```

4. ë°˜ì„±ë¬¸ ë§ˆê° ì¼ì

   ê·¸ëƒ¥ nowì— 6ì¼ì„ ë”í•´ì£¼ë©´ ëœë‹¤.(ì‹¤ì œ ê³„ì‚°ì€ nowì— 7ì¼ë§Œí¼ ë”í•œ ë‚ ì§œì´ë‹¤.)

ì´ë ‡ê²Œ ì–»ì€ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë””ìŠ¤ì»¤ì…˜ì˜ contentë¥¼ ì‘ì„±í•´ë³´ì.

- `every_week_posting_challenge/notify.js`

  ```jsx
  function makeContent(
    thisWeekDiscussionCount,
    result,
    notPostingMembers,
    apology_deadline
  ) {
    const resultText = ""
    Object.keys(result).map(name => {
      resultText += `| ${name} | ${result[name]} |\n  `
    })
    const notPostMembersText = notPostingMembers.join(", ")
    const notPostMembersCount = notPostingMembers.length
    return `
    ## ğŸ¥³ ì§€ë‚œ ì£¼ ì±Œë¦°ì§€ ìˆ˜í–‰ ê²°ê³¼: ì´ ${thisWeekDiscussionCount}ê°œ ê¸€ ì‘ì„±
  
    ### âœï¸ ë©¤ë²„ë³„ ì‘ì„±í•œ ê¸€ ìˆ˜:
    
    | ë‹‰ë„¤ì„ | ê²Œì‹œë¬¼ ìˆ˜ |
    | -------- | ---------- |
    ${resultText}
    
    ### ì±Œë¦°ì§€ë¥¼ ìˆ˜í–‰í•˜ì§€ ì•Šì€ ë©¤ë²„: ${notPostMembersCount}ëª…
    ${notPostMembersText}
    
    ### ğŸ’ª ${apology_deadline.format(
      "MMì›” DDì¼"
    )}ê¹Œì§€ ë°˜ì„±ë¬¸ì„ ì‘ì„±í•´ ë°˜ì„±ë¬¸ ì¹´í…Œê³ ë¦¬ì— ê²Œì‹œí•´ì£¼ì„¸ìš”`
  }
  ```

### ë””ìŠ¤ì»¤ì…˜ ì‘ì„±

- `every_week_posting_challenge/graphql.js`
  mutation ì¿¼ë¦¬ë¥¼ ìš”ì²­í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‘ì„±í•œë‹¤.
  ```jsx
  exports.createDiscussion = async function createDiscussion(title, body) {
    return await graphql(
      `mutation {
              createDiscussion(input: {repositoryId: "R_kgDOJjgAhg", categoryId: "DIC_kwDOJjgAhs4CWgj1", body: "${body}", title: "${title}"}) {
                  discussion {
                    id
                  }
                }
          }
        `,
      {
        headers: {
          authorization: `token ${process.env.GITHUB_TOKEN}`,
        },
      }
    )
  }
  ```
- `every_week_posting_challenge/notify.js`

  createDiscussionì„ í˜¸ì¶œí•˜ë©´ ì›í•˜ëŠ” ì–‘ì‹ìœ¼ë¡œ ë””ìŠ¤ì»¤ì…˜ì´ ì—…ë¡œë“œëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

  ```jsx
  const {
    getDiscussions,
    getNotifyDiscussions,
    createDiscussion,
  } = require('./graphql')
  	...
  	await createDiscussion(resultTitle, resultContent)
      .then(() => {
        console.log('í†µê³„ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.')
      })
      .catch(e => {
        console.log('ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
      })
    return { repository, viewer }
  }
  ```

![Untitled](8.png)

## 3. Github Actionsë¥¼ ì‚¬ìš©í•œ ì£¼ê°„ í†µê³„ ìë™ ì—…ë¡œë“œ

í° ìƒê´€ì€ ì—†ì§€ë§Œ í¸ì˜ì„±ì„ ìœ„í•´ `npm run notify` ëª…ë ¹ì–´ë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•´ì£¼ì—ˆë‹¤.

- `package.json`
  ```json
  ...
  "scripts": {
      "notify": "node every_week_posting_challenge/notify.js"
    },
  ...
  ```
- `.github/workflows/weekly_challenge_uploader.yml`

  ```yaml
  name: í‚¤ê¸€ì±Œ ì£¼ê°„ í†µê³„ ìë™ ì—…ë¡œë”

  on:
    schedule:
      - cron: "1 15 * * 0" # ë§¤ì£¼ ì›”ìš”ì¼ 00ì‹œë§ˆë‹¤ ì‹¤í–‰
    workflow_dispatch:

  jobs:
    build:
      runs-on: ubuntu-latest

      steps:
        - name: Checkout
          uses: actions/checkout@v3

        - name: Node.js
          uses: actions/setup-node@v3
          with:
            node-version: 18.x
        - name: Install Dependencies
          run: npm install
        - name: echo env
          env:
            GITHUB_TOKEN: ${{ secrets.USER_TOKEN }}
          run: echo "GITHUB_TOKEN=${GITHUB_TOKEN}" >> $GITHUB_ENV
        - name: Notify
          run: npm run notify
  ```

## ì°¸ê³  ìë£Œ

---

[Github GraphQL APIë¡œ Live Data ë°›ì•„ì˜¤ê¸°](https://velog.io/@ray/Github-GraphQL-APIë¡œ-Live-Data-ë°›ì•„ì˜¤ê¸°)

[GraphQL ê°œë…ì¡ê¸°](https://tech.kakao.com/2019/08/01/graphql-basic/)

[](https://velog.io/@sisofiy626/JavaScript-dotenv-ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼-í†µí•´-API-ê°’ì„-ìˆ¨ê²¨ë³´ì)
